<template>
    <div class="achievementBarCont">
        <div class="achievementTitleCont">
            <svg width="25px" height="25px" viewBox="0 0 25 25" version="1.1" xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink">
                <title>成果</title>
                <defs>
                    <linearGradient x1="3.88578059e-14%" y1="6.17561557e-14%" x2="100%" y2="100%" id="linearGradient-1">
                        <stop stop-color="#5F24C5" offset="0%"></stop>
                        <stop stop-color="#35B5FE" offset="100%"></stop>
                    </linearGradient>
                </defs>
                <g id="五小备份" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                    <g id="首页" transform="translate(-316.000000, -736.000000)" fill="url(#linearGradient-1)"
                        fill-rule="nonzero">
                        <g id="成果展示" transform="translate(316.000000, 734.000000)">
                            <g id="成果" transform="translate(0.000000, 2.000000)">
                                <path
                                    d="M11.2932763,0.0580040114 C12.4209259,-0.0642004521 13.5700546,0.00640657126 14.6735402,0.272540736 C16.5261074,0.715192459 18.2417457,1.7145534 19.554652,3.10496863 C20.7789573,4.39218898 21.6542281,6.01886617 22.0542752,7.75688521 C22.5456083,9.88324287 22.3442423,12.1725398 21.455547,14.1658304 C21.4286982,14.2092809 21.4260133,14.263594 21.4609168,14.3043288 C22.6100454,16.3193446 23.759174,18.3316448 24.9109875,20.3466606 C25.0264374,20.5421877 25.0291222,20.7974593 24.921727,20.9984177 C24.8411806,21.1532101 24.6935122,21.2536893 24.5404741,21.3297276 C24.4008603,21.4003346 24.2343978,21.4111973 24.0840445,21.3758937 C22.6825372,20.9739768 21.2810298,20.5666286 19.8795225,20.1674274 C19.7425936,20.6508139 19.6351984,21.1423474 19.509009,21.6284496 C19.2888489,22.5219001 19.063319,23.4153505 18.8431588,24.3088009 C18.8136251,24.4445836 18.7760368,24.583082 18.6874358,24.6917082 C18.5988347,24.811197 18.4619059,24.881804 18.3303467,24.9469797 C18.0538041,25.0691842 17.7020848,24.9659893 17.5383071,24.7107178 C16.6039689,23.0894719 15.68574,21.460079 14.7514017,19.8388332 C13.7767903,20.0723795 12.7699603,20.1728587 11.7685001,20.1103986 C11.2449485,20.0832421 10.7267667,20.0044881 10.2139546,19.8985776 C9.29572566,21.4926669 8.39092111,23.0921875 7.47537704,24.6889925 C7.35724232,24.889951 7.12365776,25.0148711 6.89275809,24.9985772 C6.73166529,25.0012928 6.58936665,24.9171075 6.45780753,24.8329222 C6.32087866,24.7433056 6.22690786,24.5966603 6.18931954,24.4391523 C5.83760026,23.0161492 5.48319611,21.5958618 5.12879195,20.1728587 C5.01871187,20.1891526 4.91131667,20.2298874 4.80392148,20.257044 C3.52591861,20.6236574 2.24523087,20.9929864 0.967228007,21.3623155 C0.800765449,21.4139129 0.612823852,21.4111973 0.457100814,21.327012 C0.312117296,21.2536893 0.164448898,21.161357 0.0865873788,21.0092804 C-0.0288624596,20.8083219 -0.0288624596,20.5476191 0.0865873788,20.3493763 C1.18738816,18.4185457 2.29087383,16.4877152 3.39167461,14.5568847 C3.42120829,14.5188655 3.41046877,14.4726994 3.38898973,14.4346802 C2.9513543,13.5222202 2.6560175,12.5418689 2.51103399,11.5370766 C2.24254599,9.68228442 2.48418519,7.74873825 3.2332667,6.02972879 C3.91522621,4.44378642 5.01334211,3.04522423 6.38263089,2.00784412 C7.81098704,0.932444839 9.52394045,0.245384189 11.2932763,0.0580040114 M12.2302995,5.25305154 C11.9913451,5.2611985 11.7523908,5.28292374 11.5161214,5.32637421 C10.2622824,5.5490579 9.11315382,6.31215689 8.40971527,7.38484051 C7.98281935,8.02573503 7.71433136,8.76982443 7.63378496,9.53835472 C7.51028048,10.6463419 7.77876848,11.7950638 8.39360599,12.7211021 C8.8741995,13.4624758 9.56421365,14.0626355 10.3589381,14.4373959 C11.1858812,14.8284502 12.1229043,14.9669486 13.0250239,14.8393128 C14.0237993,14.70353 14.9742468,14.2310061 15.6937946,13.5167889 C16.3059472,12.9166292 16.7543222,12.1453833 16.9717975,11.3089616 C17.251025,10.244425 17.162424,9.08484038 16.7113641,8.08276378 C16.3301112,7.22461688 15.6911097,6.48595879 14.9044399,5.98627832 C14.1097154,5.48116653 13.1646377,5.22317933 12.2302995,5.25305154 Z"
                                    id="形状"></path>
                                <path
                                    d="M12.1431636,6.71461132 C13.0753398,6.62625023 14.0343027,6.94220805 14.7307562,7.56609086 C15.456675,8.20068411 15.8959765,9.14855757 15.8959765,10.1151743 C15.9120485,10.9639762 15.5906084,11.8101006 15.0227309,12.4420162 C14.3852081,13.1622929 13.4369599,13.5987431 12.4753183,13.5960655 C11.5538568,13.6121312 10.6377525,13.2292331 9.99487239,12.5705414 C9.32788423,11.9038169 8.95822814,10.9532658 9.00376548,10.0134252 C9.02787349,9.35741104 9.24752421,8.70942975 9.62789497,8.17123041 C10.1984511,7.34652695 11.1440207,6.79761718 12.1431636,6.71461132 L12.1431636,6.71461132 Z"
                                    id="路径"></path>
                            </g>
                        </g>
                    </g>
                </g>
            </svg>
            <div class="achievementTitle">
              {{ achievementTitle }}
              <!-- <a class="totalTitle" v-if="myLength">({{myLength}})</a> -->
            </div>
           
        </div>
        <div class="achievementTitleLine">
          总数: {{myLength}} 条
        </div>
        <div class="achievementTitleDecoration achievementTitleDecorationTop"></div>
        <div class="achievementItemOutsideCont">
            <div v-for="(item, index) in achievementBarDataList" :key="index" class="achievementItemCont">
              <!-- v-if="index < 10"  增加了显示总数后，去掉少于10条-->
                <template >
                    <div class="achievementContentCont"  @click="goDetail(item)">
                        <div class="achievementItemImage" v-if="item.url">
                            <ImgShow v-if="item.url.length > 200" :base64="item.url" class="imgShowCont"></ImgShow>
                            <img v-else :src="gitImageUrl(index)" class="imgShowDefaultCont" />
                        </div>
                        <div class="achievementItemContentCont" v-if="typeStr == '1'">
                            <div class="achievementItemTitle">{{ getAchievementItemTitle(item) }} </div>
                            <div class="achievementItemInfo">{{ item.achievementContent }}</div>
                        </div>
                        <div class="achievementItemContentCont" v-else>
                            <div class="achievementItemTitle">{{ item.projectName }} </div>
                            <div class="achievementItemInfo">
                                <div class="achievementItemInfoAttribute">奖项：{{ item.achievementName?item.achievementName:'暂无数据' }}</div>
                                <div class="achievementItemInfoAttribute">创造人：{{ item.applyName?item.applyName:'暂无数据' }}</div>
                                <div class="achievementItemInfoAttribute">申请单位：{{ item.applyCompanyName?item.applyCompanyName:'暂无数据' }}</div>
                            </div>
                        </div>
                    </div>
                    <div v-if="(index + 1) < achievementBarDataList.length && index != 9" class="achievementItemDecoration"></div>
                </template>
                
            </div>
            <div class="noDataCont" v-if="achievementBarDataList && achievementBarDataList.length <= 0">
                <img src="../../assets/image/无数据.png"/>
                <div class="noDataContInfo">敬请期待</div>
            </div>
        </div>
        <div class="achievementTitleDecoration achievementTitleDecorationBottom"></div>

    </div>
</template>

<script>
import { downloadBase64, otherDownloadBase64 } from '@/assets/api/common/index'
import ImgShow from '@/components/workbench/imgShow.vue'
export default {
    name: 'achievementBar',
    components: { ImgShow },
    props: {
        achievementTitle: {
            type: String,
            default: ""
        },
        achievementBarDataList: {
            type: Array,
            default: []
        },
        typeStr:{
            type: String,
            default: "1"
        },
        achievementLoading:{
            type:Boolean,
            default:false,
        },
        myLength:{
            type:Number,
            default:0
        }
    },
    data() {
        return {
            defaultUrl: "../../assets/image/defaultBackground.jpg",
            updateImageSwitch: true,
            updateImageCount: 0,//0未查询过，1查询过
        }
    },
    watch: {
        achievementLoading(){
            let this_ = this;
            
            if (!this.getSelectImg()) {
                setTimeout(() => {
                    this_.updateAchievementBarDataList()
                },100);
            }
        }
    },
    mounted() {},
    computed: {},
    methods: {
        getAchievementItemTitle(item) {
            return item.achievementName ? (item.achievementName == '无' ? item.projectName : item.achievementName) : item.projectName;
        },
        getSelectImg() {
            let fals = false;
            this.achievementBarDataList.forEach((item, index) => {
                if (item.url) {
                    fals = true;
                }
            });
            return fals;
        },
        updateAchievementBarDataList() {
            this.updateImageCount = 1;
            let this_ = this;
            this.achievementBarDataList.forEach(async (item, index) => {
                this_.queryBase64(item.backImage, index);
            });
        },
        queryBase64(name, index) {
            let this_ = this;
            let params = JSON.parse(JSON.stringify(this_.achievementBarDataList[index]));
            if (name && name.length) {
                params.url = "../../assets/image/defaultBackground.jpg";
                this.updateImageUrl(index, params);
                otherDownloadBase64(name).then((res) => {
                    if (res.data) {
                        params.url = 'data:image/png;base64,' + res.data;
                    } else {
                        params.url = "../../assets/image/defaultBackground.jpg";
                    }
                    this_.updateImageUrl(index, params);
                }).catch((error) => {
                    params.url = "../../assets/image/defaultBackground.jpg";
                    this_.updateImageUrl(index, params);
                });
            } else {
                params.url = "../../assets/image/defaultBackground.jpg";
                this.updateImageUrl(index, params);
            }
        },
        updateImageUrl(index, params) {
            this.$set(this.achievementBarDataList, index, params)
        },
        gitImageUrl(index) {
            if ((typeof index) == 'number') {
                if (this.achievementBarDataList[index].url == this.defaultUrl) {
                    return require("../../assets/image/defaultBackground.jpg");
                } else {
                    return require(JSON.stringify(this.achievementBarDataList[index].url));
                }
            } else {
                return require("../../assets/image/defaultBackground.jpg");
            }
        },
        goDetail(item) {
            if (this.typeStr == '1') {
                this.$router.push(`/countryManage/countryDetail?projectId=${item.achievementId}`)
            } else {
                this.$router.push({
                    name: "myResultDetail",
                    params: {
                        applyId: item.achievementId,
                        type: "view",
                        // isWhere:"workbench",
                    },
                });
            }
        },
    }
};
</script>

<style lang="scss" scoped>
.achievementBarCont {
    width: 200px;
    flex-grow: 1;
    max-height: 100%;
   
    .achievementTitleCont {
        display: flex;
        align-items: center;

        svg {
            height: 25px;
            width: 25px;
        }

        .achievementTitle {
            padding-left: 8px;
            font-size: 21px;
            font-family: PingFangSC-Medium, PingFang SC;
            font-weight: 500;
            color: #333333;
            line-height: 29px;
        }
        .totalTitle{
          font-size: 16px;
          line-height: 29px;
          color: #5991FF;
        }
        
    }
    .achievementTitleLine{
      margin-top: 6px;
      font-size: 14px;
      color: #5991FF;
      margin-bottom: -5px;
    }
    .achievementTitleDecoration {
        height: 4px;
        background: #5991FF;
    }
    .achievementTitleDecorationTop{
        margin: 20px 0px 0px 0px;
        
    }
    .achievementTitleDecorationBottom{
        margin: 0px 0px 20px 0px;
    }
    .achievementItemOutsideCont {

        height: calc(100% - 78px);
        overflow: auto;
        .achievementItemCont {
            display: flex;
            align-items: center;
            flex-direction: column;
            width: calc(100% - 20px);
            padding: 0px 10px;
            overflow: auto;

            // width: 100%;
            .achievementContentCont {
                display: flex;
                // align-items: center;
                flex-direction: row;
                padding: 12px 10px;
                cursor: pointer;
                width: calc(100% - 20px);
                height: 110px;

                .achievementItemImage {
                    width: 45%;
                    height: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;

                    .imgShowDefaultCont {
                        object-fit: cover;
                        max-width: 100%;
                        max-height: 100%;
                    }

                    .imgShowCont {
                        width: 100%;
                        height: 100%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                }

                .achievementItemContentCont {
                    flex: 1;
                    // width: 55%;
                    padding: 0px 10px;

                    .achievementItemTitle {
                        // height: 34px;
                        font-size: 12px;
                        font-family: PingFangSC-Medium, PingFang SC;
                        font-weight: 500;
                        color: #333333;
                        line-height: 17px;
                        max-height: 34px;
                        overflow: hidden;

                        // overflow: hidden;
                        // text-overflow: ellipsis;
                        // display: -webkit-box;
                        // -webkit-line-clamp: 2; //（行数）
                        // -webkit-box-orient: vertical;
                    }

                    .achievementItemInfo {
                        padding-top: 5px;
                        font-size: 10px;
                        font-family: PingFangSC-Regular, PingFang SC;
                        font-weight: 300;
                        color: #000000;
                        line-height: 15px;
                        opacity: 45%;
                        overflow: hidden;
                        max-height: 45px;
                        // overflow: hidden;
                        // text-overflow: ellipsis;
                        // display: -webkit-box;
                        // -webkit-line-clamp: 3; //（行数）
                        // -webkit-box-orient: vertical;
                        .achievementItemInfoAttribute{
                            overflow: hidden;
                            text-overflow: ellipsis;
                            display: -webkit-box;
                            -webkit-line-clamp: 1; //（行数）
                            -webkit-box-orient: vertical;
                        }

                    }

                    // .achievementItemInfo::before {
                    //     content: "...";
                    // }
                }
            }


            .achievementItemDecoration {
                width: 100%;
                height: 2px;
                opacity: 0.1;
                background-color: #000000;
            }
        }
        .noDataCont{
            color: #909399;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding-top: 50px;
            img{
                filter: grayscale(100%) opacity(50%);
                width: 40px;
                object-fit: cover;
            }
            .noDataContInfo{
                padding-top: 6px;
                text-align: center;
                font-size: 12px;
                color: #aaa;
            }
        }

        .achievementContentCont:hover {
            background-color: #eef4ff;
        }
    }


}</style>
